Resposta da Atividade

Gerar um arquivo CSV preenchendo os campos codigoPedido;dataPedido;SKU;UPC;nomeProduto;qtd;valor;frete;email;codigoComprador;nomeComprador;endereco;CEP;UF;pais

Com o arquivo em mãos, deve-se inserir os dados na tabela sbd_dadostemp, através do comando:

LOAD DATA INFILE 'C:/Users/casol/Downloads/tempdata.csv'
INTO TABLE waterfall_dadostemp
FIELDS TERMINATED BY ';' ENCLOSED BY '"' LINES TERMINATED BY '\n'
(codigoPedido, dataPedido, SKU, UPC, nomeProduto, qtd, valor, frete, email, codigoComprador, nomeComprador, endereco, CEP, UF, pais);



Para preencher as tabelas, uma ordem será seguida (considerando que as tabelas possuem chaves estrangeiras). 

waterfall_clientes
codigoComprador
nomeComprador
email


Comando SQL:
INSERT INTO waterfall_clientes (codigoComprador, nomeComprador, email) SELECT DISTINCT codigoComprador, nomeComprador, email FROM `waterfall_dadostemp` GROUP BY email;

waterfall_compras
codigoPedido
valor
frete


Comando SQL: [ainda não fiz pq depende de codigoPedido]
INSERT INTO waterfall_compras (codigoPedido, valor, frete) SELECT DISTINCT codigoPedido, valor, frete FROM `waterfall_dadostemp`;

waterfall_entregas
codigoPedido
endereco
CEP
UF
pais


Comando SQL: 
INSERT INTO waterfall_entregas (codigoPedido, endereco, CEP, UF, pais) SELECT DISTINCT codigoPedido, endereco, CEP, UF, pais FROM `waterfall_dadostemp`;

waterfall_estoque
SKU
quantidade


INSERT INTO `waterfall_estoque` (SKU, quantidade) SELECT DISTINCT SKU, qtd FROM waterfall_dadostemp GROUP BY SKU

[ ] Habilitar verificação de chaves estrangeiras

waterfall_itens_pedido
codigoPedido
SKU
quantidade


INSERT INTO `waterfall_itens_pedido` (codigoPedido, SKU, quantidade) SELECT codigoPedido, SKU, qtd FROM waterfall_tempdata

waterfall_pedidos
codigoPedido
dataPedido
codigoComprador


Comando SQL:
INSERT INTO waterfall_pedidos (codigoPedido, dataPedido, codigoComprador) SELECT DISTINCT codigoPedido, dataPedido, codigoComprador FROM waterfall_dadostemp

[ ] Habilitar verificação de chaves estrangeiras


waterfall_produtos
SKU
UPC
nomeProduto
valor


Comando SQL:
INSERT INTO `waterfall_produtos` (SKU, UPC, nomeProduto, valor) SELECT DISTINCT SKU, UPC, nomeProduto, valor FROM waterfall_dadostemp WHERE SKU NOT IN (SELECT DISTINCT SKU FROM waterfall_produtos) GROUP BY SKU

